{"version":3,"sources":["../src/table_ctrl.js"],"names":["refresh","_ctrl","refreshDashboard","timeSrv","_","$","moment","MetricsPanelCtrl","transformDataToTable","tablePanelEditor","columnOptionsTab","TableRenderer","showActionForm","utils","panelDefaults","targets","transform","pageSize","showHeader","styles","type","pattern","alias","dateFormat","headerColor","unit","decimals","colors","colorMode","thresholds","columns","scroll","fontSize","sort","col","desc","TableCtrl","$scope","$injector","templateSrv","annotationsSrv","$sanitize","variableSrv","pageIndex","panel","fields","defaults","events","on","onDataReceived","bind","onDataError","onInitEditMode","onInitPanelActions","document","off","e","rowData","map","index","td","childNodes","length","nodeValue","text","prodLineIndex","ctrl","colDimensions","indexOf","orderIdIndex","prodDescIndex","prodIdIndex","alert","addEditorTab","actions","push","click","datasource","setTimeQueryStart","getAnnotations","dashboard","range","then","annotations","data","err","dataRaw","render","dataList","reorderData","filter","findIndex","toLowerCase","pro_line_col","splice","i","rows","row","pro_line_row","lowerCaseRow","elem","key","cols","find","a","b","entries","table","renderer","isTimezoneUtc","colIndex","scope","$new","tableData","render_values","publishAppEvent","templateHtml","modalClass","attrs","pageCount","getTableHeight","panelHeight","height","appendTableRows","tbodyElem","setTable","empty","html","switchPage","el","currentTarget","parseInt","renderPanel","appendPaginationControls","footerElem","Math","ceil","startPage","max","endPage","min","paginationList","activeClass","pageLinkElem","append","panelElem","parents","rootElem","css","addClass","x","hidden","tooltip","selector","addFilterClicked","filterData","options","column","value","operator","setAdhocFilter","unbindDestroy","$on","renderData","renderingCompleted","templateUrl"],"mappings":"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","file":"table_ctrl.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport moment from 'moment';\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\nimport { transformDataToTable } from './transformers';\nimport { tablePanelEditor } from './editor';\nimport { columnOptionsTab } from './column_options';\nimport { TableRenderer } from './renderer';\nimport { showActionForm } from './actions_form_ctrl';\nimport * as utils from './utils';\n\nimport './css/style.css!';\nimport './css/instant-serach.css!';\n\nconst panelDefaults = {\n\ttargets: [ {} ],\n\ttransform: 'timeseries_to_columns',\n\tpageSize: null,\n\tshowHeader: true,\n\tstyles: [\n\t\t{\n\t\t\ttype: 'date',\n\t\t\tpattern: 'Time',\n\t\t\talias: 'Time',\n\t\t\tdateFormat: 'YYYY-MM-DD HH:mm:ss',\n\t\t\theaderColor: 'rgba(51, 181, 229, 1)'\n\t\t},\n\t\t{\n\t\t\tunit: 'short',\n\t\t\ttype: 'number',\n\t\t\talias: '',\n\t\t\tdecimals: 2,\n\t\t\theaderColor: 'rgba(51, 181, 229, 1)',\n\t\t\tcolors: [ 'rgba(245, 54, 54, 0.9)', 'rgba(237, 129, 40, 0.89)', 'rgba(50, 172, 45, 0.97)' ],\n\t\t\tcolorMode: null,\n\t\t\tpattern: '/.*/',\n\t\t\tthresholds: []\n\t\t}\n\t],\n\tcolumns: [],\n\tscroll: true,\n\tfontSize: '100%',\n\tsort: { col: 0, desc: true }\n};\n\n//global ctrl for the exposure of refresh function for other parts of the program\nlet _ctrl;\n\nexport class TableCtrl extends MetricsPanelCtrl {\n\tconstructor($scope, $injector, templateSrv, annotationsSrv, $sanitize, variableSrv) {\n\t\tsuper($scope, $injector);\n\n\t\tthis.pageIndex = 0;\n\n\t\tif (this.panel.styles === void 0) {\n\t\t\tthis.panel.styles = this.panel.columns;\n\t\t\tthis.panel.columns = this.panel.fields;\n\t\t\tdelete this.panel.columns;\n\t\t\tdelete this.panel.fields;\n\t\t}\n\n\t\t_.defaults(this.panel, panelDefaults);\n\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\n\t\tthis.events.on('data-error', this.onDataError.bind(this));\n\t\tthis.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n\t\tthis.events.on('init-panel-actions', this.onInitPanelActions.bind(this));\n\n\t\t//Remove listeners before add it\n\t\t$(document).off('click', 'tr.tr-affect#order-mgt-operator-table-tr');\n\t\t//Show form if a row is clicked\n\t\t$(document).on('click', 'tr.tr-affect#order-mgt-operator-table-tr', function(e) {\n\t\t\tconst rowData = $('td', this).map((index, td) => {\n\t\t\t\tif (td.childNodes.length === 2) {\n\t\t\t\t\treturn td.childNodes[1].nodeValue;\n\t\t\t\t} else if (td.childNodes.length === 1) {\n\t\t\t\t\treturn $(td).text();\n\t\t\t\t} else {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst prodLineIndex = $scope.ctrl.colDimensions.indexOf('production_line');\n\t\t\tconst orderIdIndex = $scope.ctrl.colDimensions.indexOf('order_id');\n\t\t\tconst prodDescIndex = $scope.ctrl.colDimensions.indexOf('product_desc');\n\t\t\tconst prodIdIndex = $scope.ctrl.colDimensions.indexOf('product_id');\n\t\t\tif (!~prodLineIndex || !~orderIdIndex || !~prodDescIndex || !~prodIdIndex) {\n\t\t\t\tutils.alert('error', 'Error', 'Get not get this order from the database, please contact the dev team');\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tshowActionForm(\n\t\t\t\t\trowData[prodLineIndex],\n\t\t\t\t\trowData[orderIdIndex],\n\t\t\t\t\trowData[prodDescIndex],\n\t\t\t\t\trowData[prodIdIndex]\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t}\n\n\tonInitEditMode() {\n\t\tthis.addEditorTab('Options', tablePanelEditor, 2);\n\t\tthis.addEditorTab('Column Styles', columnOptionsTab, 3);\n\t}\n\n\tonInitPanelActions(actions) {\n\t\tactions.push({ text: 'Export CSV', click: 'ctrl.exportCsv()' });\n\t}\n\n\tissueQueries(datasource) {\n\t\tthis.pageIndex = 0;\n\n\t\tif (this.panel.transform === 'annotations') {\n\t\t\tthis.setTimeQueryStart();\n\t\t\treturn this.annotationsSrv\n\t\t\t\t.getAnnotations({\n\t\t\t\t\tdashboard: this.dashboard,\n\t\t\t\t\tpanel: this.panel,\n\t\t\t\t\trange: this.range\n\t\t\t\t})\n\t\t\t\t.then((annotations) => {\n\t\t\t\t\treturn { data: annotations };\n\t\t\t\t});\n\t\t}\n\n\t\treturn super.issueQueries(datasource);\n\t}\n\n\tonDataError(err) {\n\t\tthis.dataRaw = [];\n\t\tthis.render();\n\t}\n\n\tonDataReceived(dataList) {\n\t\tdataList = this.reorderData(dataList);\n\t\tdataList = this.filter(dataList);\n\t\tdataList = this.sort(dataList, 'scheduled_start_datetime'); // sort rows so that all rows are sort/order by scheduled_start_time\n\n\t\tthis.dataRaw = dataList;\n\t\tthis.pageIndex = 0;\n\t\t// automatically correct transform mode based on data\n\t\tif (this.dataRaw && this.dataRaw.length) {\n\t\t\tif (this.dataRaw[0].type === 'table') {\n\t\t\t\tthis.panel.transform = 'table';\n\t\t\t} else {\n\t\t\t\tif (this.dataRaw[0].type === 'docs') {\n\t\t\t\t\tthis.panel.transform = 'json';\n\t\t\t\t} else {\n\t\t\t\t\tif (this.panel.transform === 'table' || this.panel.transform === 'json') {\n\t\t\t\t\t\tthis.panel.transform = 'timeseries_to_rows';\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.render();\n\t}\n\n\t//Reorder the column to put the productionLine go first.\n\treorderData(dataList) {\n\t\tif (dataList.length === 0) {\n\t\t\treturn dataList;\n\t\t}\n\n\t\tif (dataList[0].columns) {\n\t\t\tlet index = dataList[0].columns.findIndex((col) => col.text.toLowerCase() === 'production_line');\n\t\t\tif (index !== -1) {\n\t\t\t\t//store data\n\t\t\t\tlet pro_line_col = dataList[0].columns[index];\n\t\t\t\t//remove data from original position\n\t\t\t\tdataList[0].columns.splice(index, 1);\n\t\t\t\t//insert data to index 1 with the stored obj\n\t\t\t\tdataList[0].columns.splice(1, 0, pro_line_col);\n\n\t\t\t\t//reorder for each row data\n\t\t\t\tfor (let i = 0; i < dataList[0].rows.length; i++) {\n\t\t\t\t\tconst row = dataList[0].rows[i];\n\t\t\t\t\tlet pro_line_row = row[index];\n\t\t\t\t\trow.splice(index, 1);\n\t\t\t\t\trow.splice(1, 0, pro_line_row);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn dataList;\n\t}\n\n\t// filter out records that are not of status of 'Replaced'\n\tfilter(dataList) {\n\t\tif (dataList.length === 0) {\n\t\t\treturn dataList;\n\t\t}\n\n\t\tlet rows = dataList[0].rows;\n\t\trows = rows.filter((row) => {\n\t\t\tconst lowerCaseRow = row.map((elem) => (typeof elem === 'string' ? elem.toLowerCase() : elem));\n\t\t\tif (lowerCaseRow.indexOf('replaced') === -1 && lowerCaseRow.indexOf('deleted') === -1) {\n\t\t\t\treturn row;\n\t\t\t}\n\t\t});\n\t\tdataList[0].rows = rows;\n\n\t\treturn dataList;\n\t}\n\n\t//sort by schedule start time\n\tsort(dataList, key) {\n\t\tif (dataList.length === 0) {\n\t\t\treturn dataList;\n\t\t}\n\t\tconst cols = dataList[0].columns;\n\t\tconst index = this.find(key, cols);\n\t\tdataList[0].rows.sort((a, b) => a[index] - b[index]);\n\t\treturn dataList;\n\t}\n\n\t//find index related to the key in the columns\n\tfind(key, cols) {\n\t\tlet index = 0;\n\t\tfor (const [ i, col ] of cols.entries()) {\n\t\t\tif (col.text === key) {\n\t\t\t\tindex = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn index;\n\t}\n\n\trender() {\n\t\tthis.table = transformDataToTable(this.dataRaw, this.panel);\n\t\t// this.table.sort(this.panel.sort);\n\t\tthis.renderer = new TableRenderer(\n\t\t\tthis.panel,\n\t\t\tthis.table,\n\t\t\tthis.dashboard.isTimezoneUtc(),\n\t\t\tthis.$sanitize,\n\t\t\tthis.templateSrv,\n\t\t\tthis.col\n\t\t);\n\n\t\treturn super.render(this.table);\n\t}\n\n\ttoggleColumnSort(col, colIndex) {\n\t\t// remove sort flag from current column\n\t\tif (this.table.columns[this.panel.sort.col]) {\n\t\t\tthis.table.columns[this.panel.sort.col].sort = false;\n\t\t}\n\n\t\tif (this.panel.sort.col === colIndex) {\n\t\t\tif (this.panel.sort.desc) {\n\t\t\t\tthis.panel.sort.desc = false;\n\t\t\t} else {\n\t\t\t\tthis.panel.sort.col = null;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.panel.sort.col = colIndex;\n\t\t\tthis.panel.sort.desc = true;\n\t\t}\n\t\tthis.render();\n\t}\n\n\texportCsv() {\n\t\tconst scope = this.$scope.$new(true);\n\t\tscope.tableData = this.renderer.render_values();\n\t\tscope.panel = 'table';\n\t\tthis.publishAppEvent('show-modal', {\n\t\t\ttemplateHtml: '<export-data-modal panel=\"panel\" data=\"tableData\"></export-data-modal>',\n\t\t\tscope,\n\t\t\tmodalClass: 'modal--narrow'\n\t\t});\n\t}\n\n\tlink(scope, elem, attrs, ctrl) {\n\t\tlet data;\n\t\tconst panel = ctrl.panel;\n\t\tlet pageCount = 0;\n\t\t_ctrl = ctrl;\n\n\t\tfunction getTableHeight() {\n\t\t\tlet panelHeight = ctrl.height;\n\n\t\t\tif (pageCount > 1) {\n\t\t\t\tpanelHeight -= 26;\n\t\t\t}\n\n\t\t\treturn panelHeight - 31 + 'px';\n\t\t}\n\n\t\tfunction appendTableRows(tbodyElem) {\n\t\t\tctrl.renderer.setTable(data);\n\t\t\ttbodyElem.empty();\n\t\t\ttbodyElem.html(ctrl.renderer.render(ctrl.pageIndex));\n\t\t}\n\n\t\tfunction switchPage(e) {\n\t\t\tconst el = $(e.currentTarget);\n\t\t\tctrl.pageIndex = parseInt(el.text(), 10) - 1;\n\t\t\trenderPanel();\n\t\t}\n\n\t\tfunction appendPaginationControls(footerElem) {\n\t\t\tfooterElem.empty();\n\n\t\t\tconst pageSize = panel.pageSize || 100;\n\t\t\tpageCount = Math.ceil(data.rows.length / pageSize);\n\t\t\tif (pageCount === 1) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst startPage = Math.max(ctrl.pageIndex - 3, 0);\n\t\t\tconst endPage = Math.min(pageCount, startPage + 9);\n\n\t\t\tconst paginationList = $('<ul></ul>');\n\n\t\t\tfor (let i = startPage; i < endPage; i++) {\n\t\t\t\tconst activeClass = i === ctrl.pageIndex ? 'active' : '';\n\t\t\t\tconst pageLinkElem = $(\n\t\t\t\t\t'<li><a class=\"table-panel-page-link pointer ' + activeClass + '\">' + (i + 1) + '</a></li>'\n\t\t\t\t);\n\t\t\t\tpaginationList.append(pageLinkElem);\n\t\t\t}\n\n\t\t\tfooterElem.append(paginationList);\n\t\t}\n\n\t\tfunction renderPanel() {\n\t\t\tconst panelElem = elem.parents('.panel-content');\n\t\t\tconst rootElem = elem.find('.table-panel-scroll');\n\t\t\tconst tbodyElem = elem.find('tbody');\n\t\t\tconst footerElem = elem.find('.table-panel-footer');\n\n\t\t\telem.css({ 'font-size': panel.fontSize });\n\t\t\tpanelElem.addClass('table-panel-content');\n\n\t\t\tappendTableRows(tbodyElem);\n\t\t\tappendPaginationControls(footerElem);\n\n\t\t\trootElem.css({ 'max-height': panel.scroll ? getTableHeight() : '' });\n\n\t\t\t// get current table column dimensions\n\t\t\tif (ctrl.table.columns) {\n\t\t\t\tctrl.colDimensions = ctrl.table.columns.filter((x) => !x.hidden).map((x) => x.text);\n\t\t\t}\n\t\t}\n\n\t\t// hook up link tooltips\n\t\telem.tooltip({\n\t\t\tselector: '[data-link-tooltip]'\n\t\t});\n\n\t\tfunction addFilterClicked(e) {\n\t\t\tconst filterData = $(e.currentTarget).data();\n\t\t\tconst options = {\n\t\t\t\tdatasource: panel.datasource,\n\t\t\t\tkey: data.columns[filterData.column].text,\n\t\t\t\tvalue: data.rows[filterData.row][filterData.column],\n\t\t\t\toperator: filterData.operator\n\t\t\t};\n\n\t\t\tctrl.variableSrv.setAdhocFilter(options);\n\t\t}\n\n\t\telem.on('click', '.table-panel-page-link', switchPage);\n\t\telem.on('click', '.table-panel-filter-link', addFilterClicked);\n\n\t\tconst unbindDestroy = scope.$on('$destroy', () => {\n\t\t\telem.off('click', '.table-panel-page-link');\n\t\t\telem.off('click', '.table-panel-filter-link');\n\t\t\tunbindDestroy();\n\t\t});\n\n\t\tctrl.events.on('render', (renderData) => {\n\t\t\tdata = renderData || data;\n\t\t\tif (data) {\n\t\t\t\trenderPanel();\n\t\t\t}\n\t\t\tctrl.renderingCompleted();\n\t\t});\n\t}\n}\n\nexport function refresh() {\n\t_ctrl.refresh();\n}\n\nexport function refreshDashboard() {\n\t_ctrl.timeSrv.refreshDashboard();\n}\n\nTableCtrl.templateUrl = './partials/module.html';\n"]}