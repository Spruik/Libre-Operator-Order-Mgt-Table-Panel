{"version":3,"sources":["../src/actions_form_ctrl.js"],"names":["showActionForm","productionLine","orderId","description","productId","tags","getRowData","callback","rowData","order_state","toLowerCase","alert","appEvents","emit","src","modalClass","model","removeListeners","addListeners","url","getInfluxLine","get","then","result","formatData","res","runningRecord","catch","console","log","e","influxHost","records","cols","results","series","columns","rows","values","i","length","row","obj","k","col","push","currents","filter","record","order_id","product_id","product_desc","current","runnings","filteredRunnings","running","undefined","runningGroups","isRunningTheLatest","_","isEqual","$","document","on","target","id","updateRecord","updateNextToRunningAndRunningExist","planned_rate","off","data","status","rate","line","writeInfluxLine","post","closeForm","tableCtrl","refresh","cur","run","currentLine","runningLine","split","join","compl_qty","machine_state","scrap_qty","actual_start_datetime","actual_end_datetime","moment","now","order_date","production_line","order_qty","scheduled_end_datetime","scheduled_start_datetime","planned_changeover_time","trigger"],"mappings":"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","file":"actions_form_ctrl.js","sourcesContent":["\nimport { appEvents } from 'app/core/core'\nimport { get, influxHost, post, alert } from './utils'\nimport * as tableCtrl from './table_ctrl'\nimport moment from 'moment'\n\nlet rowData\nlet runningRecord = {}\n\nconst closeForm = () => {\n  $('#order-mgt-operator-action-form-dismiss-btn').trigger('click')\n}\n\nfunction showActionForm(productionLine, orderId, description, productId) {\n  const tags = {\n    productionLine : productionLine, \n    orderId : orderId,\n    description : description,\n    productId : productId\n  }\n\n  getRowData(callback, tags)\n\n  function callback() {\n    if (rowData.order_state.toLowerCase() === 'planned') {\n      alert('warning', 'Warning', 'This order has NOT been released')\n      return\n    }\n    if (rowData.order_state.toLowerCase() === 'closed') {\n      alert('warning', 'Warning', 'This order has been closed')\n      return\n    }\n\n    appEvents.emit('show-modal', {\n      src: 'public/plugins/smart-factory-operator-order-mgt-table-panel/partials/actions_form.html',\n      modalClass: 'confirm-modal',\n      model: { orderId : tags.orderId }\n    })\n\n    removeListeners()\n    addListeners()\n  }\n\n}\n\n/**\n * Get the record data with the tag values passed in\n * Call the callback function once it is finished\n * Stop and prompt error when it fails\n * @param {*} callback \n * @param {*} tags \n */\nfunction getRowData(callback, tags){\n  const url = getInfluxLine(tags)\n  get(url).then(res => {\n    const result = formatData(res, tags)\n    rowData = result[0]\n    runningRecord = result[1]\n    // console.log(rowData)\n    callback()\n  }).catch(e => {\n    alert('error', 'Database Error', 'Database connection failed with influxdb')\n    console.log(e)\n  })\n}\n\n/**\n * Write line for the influxdb query\n * @param {*} tags \n */\nfunction getInfluxLine(tags){\n  let url = influxHost + 'query?pretty=true&db=smart_factory&q=select * from OrderPerformance' + ' where '\n  url += 'production_line=' + '\\'' + tags.productionLine + '\\''\n\n  // console.log(url)\n  \n  return url\n}\n\n/**\n * The params may contain more than one row record\n * This is to fomrat the http response into a better structure\n * And also filter out the latest record\n * @param {*} res \n */\nfunction formatData(res, tags){\n  let records = []\n\n  let cols = res.results[0].series[0].columns\n  let rows = res.results[0].series[0].values\n\n  for (let i = 0; i < rows.length; i++) {\n    const row = rows[i];\n    let obj = {}\n    for (let k = 0; k < cols.length; k++) {\n      const col = cols[k];\n      obj[col] = row[k]\n    }\n    records.push(obj)\n  }\n  \n  const currents = records.filter(record => record.order_id === tags.orderId && record.product_id === tags.productId && record.product_desc === tags.description)\n  const current = currents[currents.length - 1]\n\n  //find the latest running record\n  const runnings = records.filter(record => record.order_state.toLowerCase() === 'running')\n  const filteredRunnings = runnings.filter(running => running.order_id !== tags.orderId || running.product_id !== tags.productId)\n  let running = filteredRunnings[filteredRunnings.length - 1]\n  \n  //If the records of that line is new, there might be no 'running' at all, return!\n  if (running === null || running === undefined) {\n    return [current, null]\n  }\n\n  //check if the latest running record is the latest record in it's own group\n  //becuase there is possibility that the record is set to paused, so the latest running record is not the latest record for that group\n  const runningGroups = records.filter(record => record.order_id === running.order_id && record.product_id === running.product_id && record.product_desc === running.product_desc)\n  let isRunningTheLatest = _.isEqual(running, runningGroups[runningGroups.length - 1])\n  if (!isRunningTheLatest) { running = null }\n\n  // console.log(records)\n  // console.log(current);\n  // console.log(running)\n  return [current, running]\n}\n\n/**\n * Add listener for the action selection\n * If edit clicked, go to the edit form with the current record data\n * If realease clicked, change record status to 'Ready'\n * If delete clicked, change record status to 'Deleted'\n */\nfunction addListeners() {\n  $(document).on('click', 'input[type=\"button\"][name=\"order-mgt-operator-actions-radio\"]', e => {\n\n    if (e.target.id === 'flag') {\n      if(rowData.order_state.toLowerCase() === 'ready' || rowData.order_state.toLowerCase() === 'paused') {\n        updateRecord(rowData, 'Next', 0)\n      }else {\n        alert('warning', 'Warning', 'Only orders in Ready or Paused state can be flagged')\n      }\n    }else if (e.target.id === 'start') {\n      if(rowData.order_state.toLowerCase() === 'next') {\n        if (runningRecord) {          \n          updateNextToRunningAndRunningExist(rowData, runningRecord, rowData.planned_rate)\n        }else {\n          updateRecord(rowData, 'Running', rowData.planned_rate)\n        }\n      }else {\n        alert('warning', 'Warning', 'Only orders in Next state can be started')\n      }\n    }else if (e.target.id === 'pause') {\n      if(rowData.order_state.toLowerCase() === 'running') {\n        updateRecord(rowData, 'Paused', 0)\n      }else {\n        alert('warning', 'Warning', 'Only orders in Running state can be paused')\n      }\n    }else if (e.target.id === 'complete') {\n      if(rowData.order_state.toLowerCase() === 'running' || rowData.order_state.toLowerCase() === 'paused') {\n        updateRecord(rowData, 'Complete', 0)\n      }else {\n        alert('warning', 'Warning', 'Only orders in Running or Paused state can be complete')\n      }\n    }else if (e.target.id === 'close') {\n      if(rowData.order_state.toLowerCase() === 'complete') {\n        updateRecord(rowData, 'Closed', 0)\n      }else {\n        alert('warning', 'Warning', 'Only orders in Complete state can be closed')\n      }\n    }\n\n  })\n\n}\n\nfunction removeListeners() {\n  $(document).off('click', 'input[type=\"button\"][name=\"order-mgt-operator-actions-radio\"]')\n}\n\nfunction updateRecord(data, status, rate){\n  const line = writeInfluxLine(data, status, rate)\n  const url = influxHost + 'write?db=smart_factory'\n  post(url, line).then(res => {\n    alert('success', 'Success', 'Order ' + rowData.order_id + ' has been marked as ' + status)\n    closeForm()\n    tableCtrl.refresh()\n  }).catch(e => {\n    alert('error', 'Error', 'An error occurred while updating the database, please check your database connection')\n    closeForm()\n    console.log(e)\n  })\n}\n\nfunction updateNextToRunningAndRunningExist(cur, run, rate){\n  const currentLine = writeInfluxLine(cur, 'Running', rate)\n  const runningLine = writeInfluxLine(run, 'Complete', 0)\n  const url = influxHost + 'write?db=smart_factory'\n  post(url, runningLine)\n  .then(post(url, currentLine)\n        .then(res => {\n          alert('success', 'Success', 'Order ' + cur.order_id + ' has been marked as Running')\n          closeForm()\n          tableCtrl.refresh()\n        })\n  ).catch(e => {\n    alert('error', 'Error', 'An error occurred while updating the database, please check your database connection')\n    closeForm()\n    console.log(e)\n  })\n}\n\n/**\n * Expect the status string (Normally are: 'Ready' or 'Deleted')\n * Then changed the status in the line with anything else unchanged\n * @param {*} status \n */\nfunction writeInfluxLine(data, status, rate){\n  //For influxdb tag keys, must add a forward slash \\ before each space \n  let product_desc = data.product_desc.split(' ').join('\\\\ ')\n\n  let line = 'OrderPerformance,order_id=' + data.order_id + ',product_id=' + data.product_id + ',product_desc=' + product_desc + ' '\n\n  if (data.compl_qty !== null && data.compl_qty !== undefined) {\n    line += 'compl_qty=' + data.compl_qty + ','\n  }\n  if (data.machine_state !== null && data.machine_state !== undefined) {\n    line += 'machine_state=\"' + data.machine_state + '\"' + ','\n  }\n  if (data.scrap_qty !== null && data.scrap_qty !== undefined) {\n    line += 'scrap_qty=' + data.scrap_qty + ','\n  }\n  if (data.actual_start_datetime !== null && data.actual_start_datetime !== undefined) {\n    line += 'actual_start_datetime=' + data.actual_start_datetime + ','\n  }\n  if (data.actual_end_datetime !== null && data.actual_end_datetime !== undefined) {\n    line += 'actual_end_datetime=' + data.actual_end_datetime + ','\n  }\n\n  if (status === 'Running') {\n    //set actual start time = now\n    line += 'actual_start_datetime=' + moment.now() + ','\n  }else if(status === 'Complete'){\n    //set actual end time = now\n    line += 'actual_end_datetime=' + moment.now() + ','\n  }\n\n  line += 'order_state=\"' + status + '\"' + ','\n  line += 'order_date=\"' + data.order_date + '\"' + ','\n  line += 'production_line=\"' + data.production_line + '\"' + ','\n  line += 'order_qty=' + data.order_qty + ','\n  line += 'scheduled_end_datetime=' + data.scheduled_end_datetime + ','\n  line += 'scheduled_start_datetime=' + data.scheduled_start_datetime + ','\n  line += 'planned_changeover_time=\"' + data.planned_changeover_time + '\"' + ','\n  line += 'setpoint_rate=' + rate + ','\n  line += 'planned_rate=' + data.planned_rate\n\n  // console.log(line);\n  return line\n}\n\nexport { showActionForm }"]}