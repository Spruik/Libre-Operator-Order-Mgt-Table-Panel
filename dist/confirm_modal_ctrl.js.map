{"version":3,"sources":["../src/confirm_modal_ctrl.js"],"names":["utils","cons","ConfirmCtrl","data","init","prepare","conflict","current","influxLine","conflictLine","line","url","tableCtrl","toState","conflictToState","sendCamunda","sendCamundaQACheck","confirmMsg","order_id","showConfirmBtn","showModal","result","sure","post","result1","ok","alert","closeForm","refresh","STATE_START","error","setTimeout","document","querySelector","click"],"mappings":";;;;;;;;;;;;;;;AAAYA,Q;;AACAC,O;;;;;;;;;;;;;;;;;;;;;0BAECC,W;AACZ;AACA,yBAAYC,IAAZ,EAAkB;AAAA;;AACjB,UAAKC,IAAL,CAAUD,IAAV;AACA,UAAKE,OAAL;AACA;;;;0BAEIF,I,EAAM;AACV,WAAKG,QAAL,GAAgBH,KAAKG,QAArB;AACA,WAAKC,OAAL,GAAeJ,KAAKA,IAApB;AACA,WAAKG,QAAL,CAAcE,UAAd,GAA2BL,KAAKM,YAAhC;AACA,WAAKF,OAAL,CAAaC,UAAb,GAA0BL,KAAKO,IAA/B;AACA,WAAKC,GAAL,GAAWR,KAAKQ,GAAhB;AACA,WAAKC,SAAL,GAAiBT,KAAKS,SAAtB;AACA,WAAKL,OAAL,CAAaM,OAAb,GAAuBV,KAAKU,OAA5B;AACA,WAAKP,QAAL,CAAcO,OAAd,GAAwBV,KAAKW,eAA7B;AACA,WAAKC,WAAL,GAAmBZ,KAAKa,kBAAxB;AACA;;;+BAES;AACT,WAAKC,UAAL,sBAAmC,KAAKV,OAAL,CAAaW,QAAhD,cAAiE,KAAKX,OAAL,CAAaM,OAA9E,sBAAsG,KACpGP,QADoG,CAC3FY,QADX,0BACwC,KAAKZ,QAAL,CAAcO,OADtD;AAEA,WAAKM,cAAL,GAAsB,IAAtB;AACA;;;4BAEM;AACNnB,YAAMoB,SAAN,CAAgB,mBAAhB,EAAqC,IAArC;AACA;;;uCAEiB;AACjB,UAAMC,SAAS,MAAMrB,MAAMsB,IAAN,CAAWtB,MAAMuB,IAAN,CAAW,KAAKZ,GAAhB,EAAqB,KAAKJ,OAAL,CAAaC,UAAlC,CAAX,CAArB;AACA,UAAMgB,UAAU,MAAMxB,MAAMsB,IAAN,CAAWtB,MAAMuB,IAAN,CAAW,KAAKZ,GAAhB,EAAqB,KAAKL,QAAL,CAAcE,UAAnC,CAAX,CAAtB;AACA,UAAIa,OAAOI,EAAP,IAAaD,QAAQC,EAAzB,EAA6B;AAC5BzB,aAAM0B,KAAN,CACC,SADD,EAEC,SAFD,aAGU,KAAKnB,OAAL,CAAaW,QAHvB,4BAGsD,KAAKX,OAAL,CAAaM,OAHnE;AAKA,YAAKc,SAAL;AACA,YAAKf,SAAL,CAAegB,OAAf;AACA,WAAI,KAAKrB,OAAL,CAAaM,OAAb,KAAyBZ,KAAK4B,WAAlC,EAA+C;AAC9C,aAAKd,WAAL,CAAiB,KAAKR,OAAtB;AACA;AACD,OAXD,MAWO;AACNmB,aACC,OADD,EAEC,OAFD,6DAGyDL,OAAOS,KAAP,IACvDN,QAAQM,KAJV;AAMA,YAAKH,SAAL;AACA,YAAKf,SAAL,CAAegB,OAAf;AACA;AACD;;;iCAEW;AACXG,iBAAW,YAAM;AAChBC,gBAASC,aAAT,CAAuB,iCAAvB,EAA0DC,KAA1D;AACA,OAFD,EAEG,CAFH;AAGA","file":"confirm_modal_ctrl.js","sourcesContent":["import * as utils from './utils';\nimport * as cons from './constants';\n\nexport class ConfirmCtrl {\n\t/** @ngInject */\n\tconstructor(data) {\n\t\tthis.init(data);\n\t\tthis.prepare();\n\t}\n\n\tinit(data) {\n\t\tthis.conflict = data.conflict;\n\t\tthis.current = data.data;\n\t\tthis.conflict.influxLine = data.conflictLine;\n\t\tthis.current.influxLine = data.line;\n\t\tthis.url = data.url;\n\t\tthis.tableCtrl = data.tableCtrl;\n\t\tthis.current.toState = data.toState;\n\t\tthis.conflict.toState = data.conflictToState;\n\t\tthis.sendCamunda = data.sendCamundaQACheck;\n\t}\n\n\tprepare() {\n\t\tthis.confirmMsg = `To set order <${this.current.order_id}> to <${this.current.toState}>, the order <${this\n\t\t\t.conflict.order_id}> will be set to <${this.conflict.toState}>. Are you sure you want to make the change?`;\n\t\tthis.showConfirmBtn = true;\n\t}\n\n\tshow() {\n\t\tutils.showModal('confirm_form.html', this);\n\t}\n\n\tasync onConfirm() {\n\t\tconst result = await utils.sure(utils.post(this.url, this.current.influxLine));\n\t\tconst result1 = await utils.sure(utils.post(this.url, this.conflict.influxLine));\n\t\tif (result.ok && result1.ok) {\n\t\t\tutils.alert(\n\t\t\t\t'success',\n\t\t\t\t'Success',\n\t\t\t\t`Order ${this.current.order_id} has been marked as ${this.current.toState}`\n\t\t\t);\n\t\t\tthis.closeForm();\n\t\t\tthis.tableCtrl.refresh();\n\t\t\tif (this.current.toState === cons.STATE_START) {\n\t\t\t\tthis.sendCamunda(this.current);\n\t\t\t}\n\t\t} else {\n\t\t\talert(\n\t\t\t\t'error',\n\t\t\t\t'Error',\n\t\t\t\t`An error occurred while updating the database due to ${result.error ||\n\t\t\t\t\tresult1.error}, please try again or contact the dev team`\n\t\t\t);\n\t\t\tthis.closeForm();\n\t\t\tthis.tableCtrl.refresh();\n\t\t}\n\t}\n\n\tcloseForm() {\n\t\tsetTimeout(() => {\n\t\t\tdocument.querySelector('#op-mgt-confirm-modal-cancelBtn').click();\n\t\t}, 0);\n\t}\n}\n"]}