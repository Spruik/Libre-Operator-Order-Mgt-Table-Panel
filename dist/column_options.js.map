{"version":3,"sources":["../src/column_options.js"],"names":["columnOptionsTab","$q","uiSegmentSrv","restrict","scope","templateUrl","controller","ColumnOptionsCtrl","_","kbn","$scope","editor","activeStyleIndex","panelCtrl","ctrl","panel","unitFormats","getUnitFormats","colorModes","text","value","columnTypes","fontSizes","dateFormats","mappingTypes","getColumnNames","table","map","columns","col","onColorChange","bind","render","column","subItem","unit","newStyleRule","type","alias","decimals","colors","colorMode","pattern","dateFormat","thresholds","mappingType","styles","stylesCount","length","indexToInsert","last","splice","style","without","index","ref","copy","styleIndex","colorIndex","newColor","valueMaps","push","rangeMaps","from","to"],"mappings":";;;;;;;;;;;;;AA+IA;AACO,UAASA,gBAAT,CAA0BC,EAA1B,EAA8BC,YAA9B,EAA4C;AAClD;;AACA,SAAO;AACNC,aAAU,GADJ;AAENC,UAAO,IAFD;AAGNC,gBAAa,0FAHP;AAINC,eAAYC;AAJN,GAAP;AAMA;;6BAReP,gB;;;;AAhJTQ,I;;AACAC,M;;;;;;;;;;;;;;;;;;;;;gCAEMF,iB;AACZ;AACA,+BAAYG,MAAZ,EAAoB;AAAA;;AAAA;;AACnBA,YAAOC,MAAP,GAAgB,IAAhB;;AAEA,UAAKC,gBAAL,GAAwB,CAAxB;AACA,UAAKC,SAAL,GAAiBH,OAAOI,IAAxB;AACA,UAAKC,KAAL,GAAa,KAAKF,SAAL,CAAeE,KAA5B;AACA,UAAKC,WAAL,GAAmBP,IAAIQ,cAAJ,EAAnB;AACA,UAAKC,UAAL,GAAkB,CACjB,EAAEC,MAAM,UAAR,EAAoBC,OAAO,IAA3B,EADiB,EAEjB,EAAED,MAAM,MAAR,EAAgBC,OAAO,MAAvB,EAFiB,EAGjB,EAAED,MAAM,OAAR,EAAiBC,OAAO,OAAxB,EAHiB,EAIjB,EAAED,MAAM,KAAR,EAAeC,OAAO,KAAtB,EAJiB,CAAlB;AAMA,UAAKC,WAAL,GAAmB,CAClB,EAAEF,MAAM,QAAR,EAAkBC,OAAO,QAAzB,EADkB,EAElB,EAAED,MAAM,QAAR,EAAkBC,OAAO,QAAzB,EAFkB,EAGlB,EAAED,MAAM,MAAR,EAAgBC,OAAO,MAAvB,EAHkB,EAIlB,EAAED,MAAM,QAAR,EAAkBC,OAAO,QAAzB,EAJkB,CAAnB;AAMA,UAAKE,SAAL,GAAiB,CAChB,KADgB,EAEhB,KAFgB,EAGhB,MAHgB,EAIhB,MAJgB,EAKhB,MALgB,EAMhB,MANgB,EAOhB,MAPgB,EAQhB,MARgB,EAShB,MATgB,EAUhB,MAVgB,EAWhB,MAXgB,EAYhB,MAZgB,CAAjB;AAcA,UAAKC,WAAL,GAAmB;AAClB;AACA,OAAEJ,MAAM,yBAAR,EAAmCC,OAAO;AAC1C;AACA;AAFA,MAFkB,CAAnB;AAMA,UAAKI,YAAL,GAAoB,CAAE,EAAEL,MAAM,eAAR,EAAyBC,OAAO,CAAhC,EAAF,EAAuC,EAAED,MAAM,eAAR,EAAyBC,OAAO,CAAhC,EAAvC,CAApB;;AAEA,UAAKK,cAAL,GAAsB,YAAM;AAC3B,UAAI,CAAC,MAAKZ,SAAL,CAAea,KAApB,EAA2B;AAC1B,cAAO,EAAP;AACA;AACD,aAAOlB,EAAEmB,GAAF,CAAM,MAAKd,SAAL,CAAea,KAAf,CAAqBE,OAA3B,EAAoC,UAACC,GAAD,EAAS;AACnD,cAAOA,IAAIV,IAAX;AACA,OAFM,CAAP;AAGA,MAPD;;AASA,UAAKW,aAAL,GAAqB,KAAKA,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CAArB;AACA;;;;8BAEQ;AACR,WAAKlB,SAAL,CAAemB,MAAf;AACA;;;mCAEaC,M,EAAQC,O,EAAS;AAC9BD,aAAOE,IAAP,GAAcD,QAAQd,KAAtB;AACA,WAAKP,SAAL,CAAemB,MAAf;AACA;;;sCAEgB;AAChB,UAAMI,eAAe;AACpBD,aAAM,OADc;AAEpBE,aAAM,QAFc;AAGpBC,cAAO,EAHa;AAIpBC,iBAAU,CAJU;AAKpBC,eAAQ,CAAE,wBAAF,EAA4B,0BAA5B,EAAwD,yBAAxD,CALY;AAMpBC,kBAAW,IANS;AAOpBC,gBAAS,EAPW;AAQpBC,mBAAY,qBARQ;AASpBC,mBAAY,EATQ;AAUpBC,oBAAa;AAVO,OAArB;;AAaA,UAAMC,SAAS,KAAK/B,KAAL,CAAW+B,MAA1B;AACA,UAAMC,cAAcD,OAAOE,MAA3B;AACA,UAAIC,gBAAgBF,WAApB;;AAEA;AACA,UAAIA,cAAc,CAAlB,EAAqB;AACpB,WAAMG,OAAOJ,OAAOC,cAAc,CAArB,CAAb;AACA,WAAIG,KAAKR,OAAL,KAAiB,MAArB,EAA6B;AAC5BO,wBAAgBF,cAAc,CAA9B;AACA;AACD;;AAEDD,aAAOK,MAAP,CAAcF,aAAd,EAA6B,CAA7B,EAAgCb,YAAhC;AACA,WAAKxB,gBAAL,GAAwBqC,aAAxB;AACA;;;uCAEiBG,K,EAAO;AACxB,WAAKrC,KAAL,CAAW+B,MAAX,GAAoBtC,EAAE6C,OAAF,CAAU,KAAKtC,KAAL,CAAW+B,MAArB,EAA6BM,KAA7B,CAApB;AACA;;;sCAEgBE,K,EAAO;AACvB,UAAMC,MAAM,KAAKxC,KAAL,CAAW+B,MAAX,CAAkBQ,KAAlB,EAAyBd,MAArC;AACA,UAAMgB,OAAOD,IAAI,CAAJ,CAAb;AACAA,UAAI,CAAJ,IAASA,IAAI,CAAJ,CAAT;AACAA,UAAI,CAAJ,IAASC,IAAT;AACA,WAAK3C,SAAL,CAAemB,MAAf;AACA;;;mCAEayB,U,EAAYC,U,EAAY;AAAA;;AACrC,aAAO,UAACC,QAAD,EAAc;AACpB,cAAK5C,KAAL,CAAW+B,MAAX,CAAkBW,UAAlB,EAA8BjB,MAA9B,CAAqCkB,UAArC,IAAmDC,QAAnD;AACA,cAAK3B,MAAL;AACA,OAHD;AAIA;;;iCAEWoB,K,EAAO;AAClB,UAAI,CAACA,MAAMQ,SAAX,EAAsB;AACrBR,aAAMQ,SAAN,GAAkB,EAAlB;AACA;AACDR,YAAMQ,SAAN,CAAgBC,IAAhB,CAAqB,EAAEzC,OAAO,EAAT,EAAaD,MAAM,EAAnB,EAArB;AACA,WAAKN,SAAL,CAAemB,MAAf;AACA;;;oCAEcoB,K,EAAOE,K,EAAO;AAC5BF,YAAMQ,SAAN,CAAgBT,MAAhB,CAAuBG,KAAvB,EAA8B,CAA9B;AACA,WAAKzC,SAAL,CAAemB,MAAf;AACA;;;iCAEWoB,K,EAAO;AAClB,UAAI,CAACA,MAAMU,SAAX,EAAsB;AACrBV,aAAMU,SAAN,GAAkB,EAAlB;AACA;AACDV,YAAMU,SAAN,CAAgBD,IAAhB,CAAqB,EAAEE,MAAM,EAAR,EAAYC,IAAI,EAAhB,EAAoB7C,MAAM,EAA1B,EAArB;AACA,WAAKN,SAAL,CAAemB,MAAf;AACA;;;oCAEcoB,K,EAAOE,K,EAAO;AAC5BF,YAAMU,SAAN,CAAgBX,MAAhB,CAAuBG,KAAvB,EAA8B,CAA9B;AACA,WAAKzC,SAAL,CAAemB,MAAf;AACA","file":"column_options.js","sourcesContent":["import _ from 'lodash';\nimport kbn from 'app/core/utils/kbn';\n\nexport class ColumnOptionsCtrl {\n\t/** @ngInject */\n\tconstructor($scope) {\n\t\t$scope.editor = this;\n\n\t\tthis.activeStyleIndex = 0;\n\t\tthis.panelCtrl = $scope.ctrl;\n\t\tthis.panel = this.panelCtrl.panel;\n\t\tthis.unitFormats = kbn.getUnitFormats();\n\t\tthis.colorModes = [\n\t\t\t{ text: 'Disabled', value: null },\n\t\t\t{ text: 'Cell', value: 'cell' },\n\t\t\t{ text: 'Value', value: 'value' },\n\t\t\t{ text: 'Row', value: 'row' }\n\t\t];\n\t\tthis.columnTypes = [\n\t\t\t{ text: 'Number', value: 'number' },\n\t\t\t{ text: 'String', value: 'string' },\n\t\t\t{ text: 'Date', value: 'date' },\n\t\t\t{ text: 'Hidden', value: 'hidden' }\n\t\t];\n\t\tthis.fontSizes = [\n\t\t\t'80%',\n\t\t\t'90%',\n\t\t\t'100%',\n\t\t\t'110%',\n\t\t\t'120%',\n\t\t\t'130%',\n\t\t\t'150%',\n\t\t\t'160%',\n\t\t\t'180%',\n\t\t\t'200%',\n\t\t\t'220%',\n\t\t\t'250%'\n\t\t];\n\t\tthis.dateFormats = [\n\t\t\t// { text: 'YYYY-MM-DD HH:mm:ss', value: 'YYYY-MM-DD HH:mm:ss' },\n\t\t\t{ text: 'YYYY-MM-DD HH:mm:ss.SSS', value: 'YYYY-MM-DD HH:mm:ss.SSS' }\n\t\t\t// { text: 'MM/DD/YY h:mm:ss a', value: 'MM/DD/YY h:mm:ss a' },\n\t\t\t// { text: 'MMMM D, YYYY LT', value: 'MMMM D, YYYY LT' },\n\t\t];\n\t\tthis.mappingTypes = [ { text: 'Value to text', value: 1 }, { text: 'Range to text', value: 2 } ];\n\n\t\tthis.getColumnNames = () => {\n\t\t\tif (!this.panelCtrl.table) {\n\t\t\t\treturn [];\n\t\t\t}\n\t\t\treturn _.map(this.panelCtrl.table.columns, (col) => {\n\t\t\t\treturn col.text;\n\t\t\t});\n\t\t};\n\n\t\tthis.onColorChange = this.onColorChange.bind(this);\n\t}\n\n\trender() {\n\t\tthis.panelCtrl.render();\n\t}\n\n\tsetUnitFormat(column, subItem) {\n\t\tcolumn.unit = subItem.value;\n\t\tthis.panelCtrl.render();\n\t}\n\n\taddColumnStyle() {\n\t\tconst newStyleRule = {\n\t\t\tunit: 'short',\n\t\t\ttype: 'number',\n\t\t\talias: '',\n\t\t\tdecimals: 2,\n\t\t\tcolors: [ 'rgba(245, 54, 54, 0.9)', 'rgba(237, 129, 40, 0.89)', 'rgba(50, 172, 45, 0.97)' ],\n\t\t\tcolorMode: null,\n\t\t\tpattern: '',\n\t\t\tdateFormat: 'YYYY-MM-DD HH:mm:ss',\n\t\t\tthresholds: [],\n\t\t\tmappingType: 1\n\t\t};\n\n\t\tconst styles = this.panel.styles;\n\t\tconst stylesCount = styles.length;\n\t\tlet indexToInsert = stylesCount;\n\n\t\t// check if last is a catch all rule, then add it before that one\n\t\tif (stylesCount > 0) {\n\t\t\tconst last = styles[stylesCount - 1];\n\t\t\tif (last.pattern === '/.*/') {\n\t\t\t\tindexToInsert = stylesCount - 1;\n\t\t\t}\n\t\t}\n\n\t\tstyles.splice(indexToInsert, 0, newStyleRule);\n\t\tthis.activeStyleIndex = indexToInsert;\n\t}\n\n\tremoveColumnStyle(style) {\n\t\tthis.panel.styles = _.without(this.panel.styles, style);\n\t}\n\n\tinvertColorOrder(index) {\n\t\tconst ref = this.panel.styles[index].colors;\n\t\tconst copy = ref[0];\n\t\tref[0] = ref[2];\n\t\tref[2] = copy;\n\t\tthis.panelCtrl.render();\n\t}\n\n\tonColorChange(styleIndex, colorIndex) {\n\t\treturn (newColor) => {\n\t\t\tthis.panel.styles[styleIndex].colors[colorIndex] = newColor;\n\t\t\tthis.render();\n\t\t};\n\t}\n\n\taddValueMap(style) {\n\t\tif (!style.valueMaps) {\n\t\t\tstyle.valueMaps = [];\n\t\t}\n\t\tstyle.valueMaps.push({ value: '', text: '' });\n\t\tthis.panelCtrl.render();\n\t}\n\n\tremoveValueMap(style, index) {\n\t\tstyle.valueMaps.splice(index, 1);\n\t\tthis.panelCtrl.render();\n\t}\n\n\taddRangeMap(style) {\n\t\tif (!style.rangeMaps) {\n\t\t\tstyle.rangeMaps = [];\n\t\t}\n\t\tstyle.rangeMaps.push({ from: '', to: '', text: '' });\n\t\tthis.panelCtrl.render();\n\t}\n\n\tremoveRangeMap(style, index) {\n\t\tstyle.rangeMaps.splice(index, 1);\n\t\tthis.panelCtrl.render();\n\t}\n}\n\n/** @ngInject */\nexport function columnOptionsTab($q, uiSegmentSrv) {\n\t'use strict';\n\treturn {\n\t\trestrict: 'E',\n\t\tscope: true,\n\t\ttemplateUrl: 'public/plugins/smart-factory-operator-order-mgt-table-panel/partials/column_options.html',\n\t\tcontroller: ColumnOptionsCtrl\n\t};\n}\n"]}