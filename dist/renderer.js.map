{"version":3,"sources":["../src/renderer.js"],"names":["_","moment","kbn","TableRenderer","panel","table","isUtc","sanitize","templateSrv","initColumns","formatters","colorState","colIndex","columns","length","column","title","text","i","styles","style","regex","stringToJsRegex","pattern","match","alias","replace","createColumnFormatter","value","thresholds","colors","first","v","undefined","isArray","join","escape","defaultCellFormatter","type","isString","isNaN","parseInt","date","utc","format","dateFormat","mappingType","valueMaps","map","Number","setColorState","rangeMaps","from","to","valueFormatter","valueFormats","unit","decimals","colorMode","numericValue","getColorForValue","rowIndex","scopedVars","cellVariable","row","rows","columnIndex","addWidthHack","formatColumnValue","cellStyle","textStyle","cellClasses","cellClass","cell","push","columnHtml","hidden","preserveFormat","link","renderRowVariables","cellLink","linkUrl","encodeURIComponent","cellLinkTooltip","linkTooltip","cellTarget","linkTargetBlank","filterable","page","pageSize","startPos","endPos","Math","min","html","rowClasses","rowID","rowClass","status","y","lowerCaseRow","elem","toLowerCase","cellHtml","rowStyle","indexOf","renderCell","newRow"],"mappings":"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","file":"renderer.js","sourcesContent":["import _ from 'lodash';\nimport moment from 'moment';\nimport kbn from 'app/core/utils/kbn';\n// import { stringToJsRegex } from '@grafana/data';\n\nexport class TableRenderer {\n\tconstructor(panel, table, isUtc, sanitize, templateSrv) {\n\t\tthis.panel = panel;\n\t\tthis.table = table;\n\t\tthis.isUtc = isUtc;\n\t\tthis.sanitize = sanitize;\n\t\tthis.templateSrv = templateSrv;\n\t\tthis.initColumns();\n\t}\n\n\tsetTable(table) {\n\t\tthis.table = table;\n\t\tthis.initColumns();\n\t}\n\n\tinitColumns() {\n\t\tthis.formatters = [];\n\t\tthis.colorState = {};\n\t\tfor (let colIndex = 0; colIndex < this.table.columns.length; colIndex++) {\n\t\t\tconst column = this.table.columns[colIndex];\n\t\t\tcolumn.title = column.text;\n\n\t\t\tfor (let i = 0; i < this.panel.styles.length; i++) {\n\t\t\t\tconst style = this.panel.styles[i];\n\n\t\t\t\t// const regex = stringToJsRegex(style.pattern); // for v6.3 and above\n\t\t\t\tconst regex = kbn.stringToJsRegex(style.pattern); // for v6.0\n\t\t\t\tif (column.text.match(regex)) {\n\t\t\t\t\tcolumn.style = style;\n\n\t\t\t\t\tif (style.alias) {\n\t\t\t\t\t\tcolumn.title = column.text.replace(regex, style.alias);\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.formatters[colIndex] = this.createColumnFormatter(column);\n\t\t}\n\t}\n\n\tgetColorForValue(value, style) {\n\t\tif (!style.thresholds) {\n\t\t\treturn null;\n\t\t}\n\t\tfor (let i = style.thresholds.length; i > 0; i--) {\n\t\t\tif (value >= style.thresholds[i - 1]) {\n\t\t\t\treturn style.colors[i];\n\t\t\t}\n\t\t}\n\t\treturn _.first(style.colors);\n\t}\n\n\tdefaultCellFormatter(v, style) {\n\t\tif (v === null || v === void 0 || v === undefined) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif (_.isArray(v)) {\n\t\t\tv = v.join(', ');\n\t\t}\n\n\t\tif (style && style.sanitize) {\n\t\t\treturn this.sanitize(v);\n\t\t} else {\n\t\t\treturn _.escape(v);\n\t\t}\n\t}\n\n\tcreateColumnFormatter(column) {\n\t\tif (!column.style) {\n\t\t\treturn this.defaultCellFormatter;\n\t\t}\n\n\t\tif (column.style.type === 'hidden') {\n\t\t\treturn (v) => {\n\t\t\t\treturn undefined;\n\t\t\t};\n\t\t}\n\n\t\tif (column.style.type === 'date') {\n\t\t\treturn (v) => {\n\t\t\t\tif (v === undefined || v === null) {\n\t\t\t\t\treturn '-';\n\t\t\t\t}\n\n\t\t\t\tif (_.isArray(v)) {\n\t\t\t\t\tv = v[0];\n\t\t\t\t}\n\n\t\t\t\t// if is an epoch (numeric string and len > 12)\n\t\t\t\tif (_.isString(v) && !isNaN(v) && v.length > 12) {\n\t\t\t\t\tv = parseInt(v, 10);\n\t\t\t\t}\n\n\t\t\t\tlet date = moment(v);\n\n\t\t\t\tif (this.isUtc) {\n\t\t\t\t\tdate = date.utc();\n\t\t\t\t}\n\t\t\t\treturn date.format(column.style.dateFormat);\n\t\t\t};\n\t\t}\n\n\t\tif (column.style.type === 'string') {\n\t\t\treturn (v) => {\n\t\t\t\tif (_.isArray(v)) {\n\t\t\t\t\tv = v.join(', ');\n\t\t\t\t}\n\n\t\t\t\tconst mappingType = column.style.mappingType || 0;\n\n\t\t\t\tif (mappingType === 1 && column.style.valueMaps) {\n\t\t\t\t\tfor (let i = 0; i < column.style.valueMaps.length; i++) {\n\t\t\t\t\t\tconst map = column.style.valueMaps[i];\n\n\t\t\t\t\t\tif (v === null) {\n\t\t\t\t\t\t\tif (map.value === 'null') {\n\t\t\t\t\t\t\t\treturn map.text;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Allow both numeric and string values to be mapped\n\t\t\t\t\t\tif ((!_.isString(v) && Number(map.value) === Number(v)) || map.value === v) {\n\t\t\t\t\t\t\tthis.setColorState(v, column.style);\n\t\t\t\t\t\t\treturn this.defaultCellFormatter(map.text, column.style);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (mappingType === 2 && column.style.rangeMaps) {\n\t\t\t\t\tfor (let i = 0; i < column.style.rangeMaps.length; i++) {\n\t\t\t\t\t\tconst map = column.style.rangeMaps[i];\n\n\t\t\t\t\t\tif (v === null) {\n\t\t\t\t\t\t\tif (map.from === 'null' && map.to === 'null') {\n\t\t\t\t\t\t\t\treturn map.text;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (Number(map.from) <= Number(v) && Number(map.to) >= Number(v)) {\n\t\t\t\t\t\t\tthis.setColorState(v, column.style);\n\t\t\t\t\t\t\treturn this.defaultCellFormatter(map.text, column.style);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (v === null || v === void 0) {\n\t\t\t\t\treturn '-';\n\t\t\t\t}\n\n\t\t\t\tthis.setColorState(v, column.style);\n\t\t\t\treturn this.defaultCellFormatter(v, column.style);\n\t\t\t};\n\t\t}\n\n\t\tif (column.style.type === 'number') {\n\t\t\tconst valueFormatter = kbn.valueFormats[column.unit || column.style.unit];\n\n\t\t\treturn (v) => {\n\t\t\t\tif (v === null || v === void 0) {\n\t\t\t\t\treturn '-';\n\t\t\t\t}\n\n\t\t\t\tif (_.isString(v) || _.isArray(v)) {\n\t\t\t\t\treturn this.defaultCellFormatter(v, column.style);\n\t\t\t\t}\n\n\t\t\t\tthis.setColorState(v, column.style);\n\t\t\t\treturn valueFormatter(v, column.style.decimals, null);\n\t\t\t};\n\t\t}\n\n\t\treturn (value) => {\n\t\t\treturn this.defaultCellFormatter(value, column.style);\n\t\t};\n\t}\n\n\tsetColorState(value, style) {\n\t\tif (!style.colorMode) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (value === null || value === void 0 || _.isArray(value)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst numericValue = Number(value);\n\t\tif (isNaN(numericValue)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.colorState[style.colorMode] = this.getColorForValue(numericValue, style);\n\t}\n\n\trenderRowVariables(rowIndex) {\n\t\tconst scopedVars = {};\n\t\tlet cellVariable;\n\t\tconst row = this.table.rows[rowIndex];\n\t\tfor (let i = 0; i < row.length; i++) {\n\t\t\tcellVariable = `__cell_${i}`;\n\t\t\tscopedVars[cellVariable] = { value: row[i] };\n\t\t}\n\t\treturn scopedVars;\n\t}\n\n\tformatColumnValue(colIndex, value) {\n\t\treturn this.formatters[colIndex] ? this.formatters[colIndex](value) : value;\n\t}\n\n\trenderCell(columnIndex, rowIndex, value, addWidthHack = false) {\n\t\tvalue = this.formatColumnValue(columnIndex, value);\n\n\t\tconst column = this.table.columns[columnIndex];\n\t\tlet cellStyle = '';\n\t\tlet textStyle = '';\n\t\tconst cellClasses = [];\n\t\tlet cellClass = '';\n\n\t\tif (this.colorState.cell) {\n\t\t\tcellStyle = ' style=\"background-color:' + this.colorState.cell + '\"';\n\t\t\tcellClasses.push('table-panel-color-cell');\n\t\t\tthis.colorState.cell = null;\n\t\t} else if (this.colorState.value) {\n\t\t\ttextStyle = ' style=\"color:' + this.colorState.value + '\"';\n\t\t\tthis.colorState.value = null;\n\t\t}\n\t\t// because of the fixed table headers css only solution\n\t\t// there is an issue if header cell is wider the cell\n\t\t// this hack adds header content to cell (not visible)\n\t\tlet columnHtml = '';\n\t\tif (addWidthHack) {\n\t\t\tcolumnHtml = '<div class=\"table-panel-width-hack\">' + this.table.columns[columnIndex].title + '</div>';\n\t\t}\n\n\t\tif (value === undefined) {\n\t\t\tcellStyle = ' style=\"display:none;\"';\n\t\t\tcolumn.hidden = true;\n\t\t} else {\n\t\t\tcolumn.hidden = false;\n\t\t}\n\n\t\tif (column.hidden === true) {\n\t\t\treturn '';\n\t\t}\n\n\t\tif (column.style && column.style.preserveFormat) {\n\t\t\tcellClasses.push('table-panel-cell-pre');\n\t\t}\n\n\t\tif (column.style && column.style.link) {\n\t\t\t// Render cell as link\n\t\t\tconst scopedVars = this.renderRowVariables(rowIndex);\n\t\t\tscopedVars['__cell'] = { value: value };\n\n\t\t\tconst cellLink = this.templateSrv.replace(column.style.linkUrl, scopedVars, encodeURIComponent);\n\t\t\tconst cellLinkTooltip = this.templateSrv.replace(column.style.linkTooltip, scopedVars);\n\t\t\tconst cellTarget = column.style.linkTargetBlank ? '_blank' : '';\n\n\t\t\tcellClasses.push('table-panel-cell-link');\n\n\t\t\tcolumnHtml += `\n        <a href=\"${cellLink}\" target=\"${cellTarget}\" data-link-tooltip data-original-title=\"${cellLinkTooltip}\" data-placement=\"right\"${textStyle}>\n          ${value}\n        </a>\n      `;\n\t\t} else {\n\t\t\tcolumnHtml += value;\n\t\t}\n\n\t\tif (column.filterable) {\n\t\t\tcellClasses.push('table-panel-cell-filterable');\n\t\t\tcolumnHtml += `\n        <a class=\"table-panel-filter-link\" data-link-tooltip data-original-title=\"Filter out value\" data-placement=\"bottom\"\n           data-row=\"${rowIndex}\" data-column=\"${columnIndex}\" data-operator=\"!=\">\n          <i class=\"fa fa-search-minus\"></i>\n        </a>\n        <a class=\"table-panel-filter-link\" data-link-tooltip data-original-title=\"Filter for value\" data-placement=\"bottom\"\n           data-row=\"${rowIndex}\" data-column=\"${columnIndex}\" data-operator=\"=\">\n          <i class=\"fa fa-search-plus\"></i>\n        </a>`;\n\t\t}\n\n\t\tif (cellClasses.length) {\n\t\t\tcellClass = ' class=\"' + cellClasses.join(' ') + '\"';\n\t\t}\n\n\t\tcolumnHtml = '<td' + cellClass + cellStyle + textStyle + '>' + columnHtml + '</td>';\n\t\treturn columnHtml;\n\t}\n\n\trender(page) {\n\t\tconst pageSize = this.panel.pageSize || 100;\n\t\tconst startPos = page * pageSize;\n\t\tconst endPos = Math.min(startPos + pageSize, this.table.rows.length);\n\t\tlet html = '';\n\t\tconst rowClasses = [ 'tr-affect' ];\n\t\tconst rowID = ' id=\"order-mgt-operator-table-tr\"';\n\t\tlet rowClass = '';\n\t\tconst status = [ '' ];\n\n\t\tfor (let y = startPos; y < endPos; y++) {\n\t\t\tconst row = this.table.rows[y];\n\t\t\tconst lowerCaseRow = row.map((elem) => (typeof elem === 'string' ? elem.toLowerCase() : elem));\n\t\t\tlet cellHtml = '';\n\t\t\tlet rowStyle = '';\n\n\t\t\tif (lowerCaseRow.indexOf('planned') > -1) {\n\t\t\t\tthis.colorState.row = '#C9C9C9';\n\t\t\t} else if (lowerCaseRow.indexOf('next') > -1) {\n\t\t\t\tthis.colorState.row = '#FFFB85';\n\t\t\t} else if (lowerCaseRow.indexOf('running') > -1) {\n\t\t\t\tthis.colorState.row = '#91F449';\n\t\t\t} else if (lowerCaseRow.indexOf('paused') > -1) {\n\t\t\t\tthis.colorState.row = '#E8B20C';\n\t\t\t} else if (lowerCaseRow.indexOf('complete') > -1) {\n\t\t\t\tthis.colorState.row = '#70C6FF';\n\t\t\t} else if (lowerCaseRow.indexOf('closed') > -1) {\n\t\t\t\tthis.colorState.row = '#FF7773';\n\t\t\t} else if (lowerCaseRow.indexOf('ready') > -1) {\n\t\t\t\tthis.colorState.row = '#CCFFAF';\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < this.table.columns.length; i++) {\n\t\t\t\tcellHtml += this.renderCell(i, y, row[i], y === startPos);\n\t\t\t}\n\n\t\t\tif (this.colorState.row) {\n\t\t\t\trowStyle = ' style=\"background-color:' + this.colorState.row + ';color: black;\"';\n\t\t\t\trowClasses.push('table-panel-color-row');\n\t\t\t\tthis.colorState.row = 'white';\n\t\t\t}\n\n\t\t\tif (rowClasses.length) {\n\t\t\t\trowClass = ' class=\"' + rowClasses.join(' ') + '\"';\n\t\t\t}\n\n\t\t\thtml += '<tr ' + rowClass + rowStyle + rowID + '>' + cellHtml + '</tr>';\n\t\t}\n\n\t\treturn html;\n\t}\n\n\trender_values() {\n\t\tconst rows = [];\n\n\t\tfor (let y = 0; y < this.table.rows.length; y++) {\n\t\t\tconst row = this.table.rows[y];\n\t\t\tconst newRow = [];\n\t\t\tfor (let i = 0; i < this.table.columns.length; i++) {\n\t\t\t\tnewRow.push(this.formatColumnValue(i, row[i]));\n\t\t\t}\n\t\t\trows.push(newRow);\n\t\t}\n\t\treturn {\n\t\t\tcolumns: this.table.columns,\n\t\t\trows: rows\n\t\t};\n\t}\n}\n"]}